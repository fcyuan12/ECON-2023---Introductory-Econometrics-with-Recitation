---
title: "TA Session 2"
author: "Chi-Yuan Fang"
date: "March 9, 2021"
output: 
  html_document:
    toc: true
    number_sections: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#library(kableExtra)
```

# Introduction

## TA Information

TA: Chi-Yuan Fang

TA sessions: Tuesday 1:20 – 3:10 PM (SS 501) 

Email: r09323017@ntu.edu.tw

Office hours: Friday 2:00 – 3:30 PM or by appointments (SS 643)

Class group on Facebook: Statistics (Fall 2020) and Econometrics (Spring 2021) 

<https://www.facebook.com/groups/452292659024369/>

Because screens are not clear in SS 501, I will provide the link of live streaming in the group.


## TA Sessions Schedule

| Week | TA Sessions    | Quiz | Content | Remind |
|------|-------------|------|-------------------------|-----------------|
|  1   | 02/23: No class| | | | |
|  2   | 03/02: Class 1 | | Function, Confidence Interval, T test | 03/10 Turn in HW1 |
|  3   | 03/09: Class 2 | | Loops, Linear Model | 03/10 Turn in HW1, 03/16 Quiz 1 |
|  4   | 03/16: Class 3 | Quiz 1 |  | 03/24 Turn in HW2 |
|  5   | 03/23: Class 4 | |  | 03/24 Turn in HW2, 03/30 Quiz 2 |
|  6   | 03/30: Class 5 | Quiz 2 |  | 04/14 Turn in HW3 |
|  7   | 04/06: No class | | | 04/14 Turn in HW3 |
|  8   | 04/13: Class 6 | |  | 04/14 Turn in HW3, 04/20 Quiz 3 |
|  9   | 04/20: Class 7 | Quiz 3 | | **04/28 Midterm** |
| 10   | 04/27: Class 8 | | Review and Q&A | **04/28 Midterm**, 05/05 Turn in HW4 |
| 11   | 05/04: Class 9| |  | 05/05 Turn in HW4, 05/11 Quiz 4 |
| 12   | 05/11: Class 10| Quiz 4 |  | 05/19 Turn in HW5 |
| 13   | 05/18: Class 11| |  | 05/19 Turn in HW5, 05/25 Quiz 5 |
| 14   | 05/25: Class 12| Quiz 5 |  | 06/02 Turn in HW6 |
| 15   | 06/01: Class 13| |  | 06/02 Turn in HW6, 06/08 Quiz 6 |
| 16   | 06/08: Class 14| Quiz 6 | Review and Q&A | **06/16 Final Exam** | 
| 17   | 06/15: No class| | | **06/16 Final Exam** | 
| 18   | 06/22: No class| | |  |

## Reference

Introduction to Econometrics with R

<https://www.econometrics-with-r.org>

R for Data Science 

<https://r4ds.had.co.nz>

R Markdown

<https://rmarkdown.rstudio.com>

Introduction to R Markdown

<https://rpubs.com/brandonkopp/RMarkdown>

What is a good book on learning R with examples?

<https://www.quora.com/What-is-a-good-book-on-learning-R-with-examples>

# Empirical Exercise 4.1

> On the text website, <http://www.pearsonglobaleditions.com>, you will find the data file **Growth**, which contains data on average growth rates from 1960 through 1995 for 65 countries, along with variables that are potentially related to growth. A detailed description is given in **Growth_Description**, also available on the website. In this exercise, you will investigate the relationship between growth and trade.

> a. Construct a scatterplot of average annual growth rate $(Growth)$ on the average trade share $(TradeShare)$. Does there appear to be a relationship between the variables?

**Solution**

```{r}
# import data 
#install.packages("readxl")
library(readxl)
Growth <- read_xlsx("Growth/Growth.xlsx")

plot(x = Growth$tradeshare, 
     y = Growth$growth,
     pch = 16, # filled circle
     col = "black",
     xlim = c(0, 2),
     ylim = c(-3, 8),
     xlab = "TradeShare",
     ylab = "Growth",
     main = "E4.1 (a)")

```

> b. One country, Malta, has a trade share much larger than the other countries. Find Malta on the scatterplot. Does Malta look like an outlier?

**Solution**

```{r}
Growth[Growth$country_name =="Malta",]
```

Malta is the “outlying” observation with a trade share of 1.99.

> c. Using all observations, run a regression of $Growth$ on $TradeShare$. What is the estimated slope? What is the estimated intercept? Use the regression to predict the growth rate for a country with a trade share of 0.5 and for another with a trade share equal to 1.0.

**Solution**

```{r}
# regression 
E41c <- lm(formula = growth ~ tradeshare, data = Growth)

# estimated intercept, estimated slope
summary(E41c)

# predict value
E41c_predict <- function(x){
  E41c$coefficients %*% matrix(c(1, x), ncol = 1)
  
}

# predict value: tradeshare = 0.5
E41c_predict(0.5)

# predict value: tradeshare = 1.0
E41c_predict(1)
```


> d. Estimate the same regression, excluding the data from Malta. Answer the same questions in (c).

**Solution**

```{r}
# excluding the data from Malta
Growth_n <- Growth[Growth$country_name !="Malta",]

# regression 
E41d <- lm(formula = growth ~ tradeshare, data = Growth_n)

# estimated intercept, estimated slope
summary(E41d)

# predict value
E41d_predict <- function(x){
  E41d$coefficients %*% matrix(c(1, x), ncol = 1)
  
}

# predict value: tradeshare = 0.5
E41d_predict(0.5)

# predict value: tradeshare = 1.0
E41d_predict(1)

```


> e. Plot the estimated regression functions from (c) and (d). Using the scatterplot in (a), explain why the regression function that includes Malta is steeper than the regression function that excludes Malta.

**Solution**

```{r}
plot(x = Growth$tradeshare, 
     y = Growth$growth,
     pch = 16, # filled circle
     col = "black",
     xlim = c(0, 2),
     ylim = c(-3, 8),
     xlab = "TradeShare",
     ylab = "Growth",
     main = "E4.1 (e)")

# with Malta
abline(E41c, lwd = 2, col = "steelblue") 
text(1.5, 6, "OLS regression line including Malta", col = "steelblue")

# without Malta
abline(E41d, lwd = 2, col = "red") 
text(1.5, 0, "OLS regression line excluding Malta", col = "red")
```


> f. Where is Malta? Why is the Malta trade share so large? Should Malta be included or excluded from the analysis?

**Solution**

Malta is an island nation in the Mediterranean Sea, south of Sicily.

Malta is a freight transport site, which explains its large “trade share.” Many goods coming into Malta (imports into Malta) and are immediately transported to other countries (as exports from Malta). 

Thus, Malta’s imports and exports are unlike the imports and exports of most other countries. Malta should not be included in the analysis.


# Empirical Exercise 4.2


> On the text website, <http://www.pearsonglobaleditions.com>, you will find the data file **Earnings_and_Height**, which contains data on earnings, height, and other characteristics of a random sample of U.S. workers. A detailed description is given in **Earnings_and_Height_Description**, also available on the website. In this exercise, you will investigate the relationship between earnings and height.

> a. What is the median value of height in the sample?

**Solution**

```{r}
# import data 
#install.packages("readxl")
library(readxl)
Earnings_and_Height <- read_xlsx("Earnings_and_Height/Earnings_and_Height.xlsx")

median(Earnings_and_Height$height)

```


> b. 
>     i. Estimate average earnings for workers whose height is at most
67 inches.
>     ii. Estimate average earnings for workers whose height is greater than
67 inches.
>     iii. On average, do taller workers earn more than shorter workers? How
much more? What is a 95\% confidence interval for the difference in average earnings?

**Solution**

```{r}
# create "group" variable
group <- c()

for (i in 1:length(Earnings_and_Height$height)){
  if (Earnings_and_Height$height[i] <= 67){
    # group 0: height <= 67
    group[i] <- c(0) 
  } else {
    # group 1: height > 67
    group[i] <- c(1) 
  }
}

Earnings_and_Height <- cbind(Earnings_and_Height, group)

E42b <- function(x){
  # sample mean
  mu <- mean(x)
  
  # sample standard deviation (standard error)
  se <- sd(x)/sqrt(length(x))
  
  # test
  test <- t.test(x, 
                 alternative = c("two.sided"),
                 mu = 0, # H0
                 conf.level = 0.95) # alpha = 0.05
  
  # 95% confidence interval
  lower <- round(test$conf.int[1], digit = 4)
  upper <- round(test$conf.int[2], digit = 4)
  CI <- paste(lower, "-"  ,upper)
  
  Table <- data.frame(mu, se, CI)
  colnames(Table) <- c("Mean", "Standard Error", "95% Confidence Interval")
  
  Table

}

# i. # ii.
tapply(Earnings_and_Height$earnings, Earnings_and_Height$group, E42b)

# height <= 67
Earnings_and_Height_i <- Earnings_and_Height[Earnings_and_Height$height <= 67, ]

# height > 67
Earnings_and_Height_ii <- Earnings_and_Height[Earnings_and_Height$height > 67, ]

# iii. 95% CI for difference
t.test(Earnings_and_Height_ii$earnings, Earnings_and_Height_i$earnings, 
       alternative = c("two.sided"),
       mu = 0, # H0
       var.equal = FALSE,
       conf.level = 0.95) # alpha = 0.05

```


> c. Construct a scatterplot of annual earnings $(Earnings)$ on height $(Height)$.
Notice that the points on the plot fall along horizontal lines. (There are only 23 distinct values of $Earnings$). Why? (Hint: Carefully read the detailed data description.)

**Solution**

```{r}
plot(x = Earnings_and_Height$height, 
     y = Earnings_and_Height$earnings,
     pch = 16, # filled circle
     col = "black",
     xlim = c(45, 90),
     ylim = c(0, 85000),
     xlab = "height",
     ylab = "earnings",
     main = "E4.2 (c)")

```

The data documentation reports that individual earnings were reported in 23 brackets, and a single average value is reported for earnings in the same bracket. Thus, the dataset contains 23 distinct values of earnings.


> d. Run a regression of $Earnings$ on $Height$.
>     i. What is the estimated slope?
>     ii. Use the estimated regression to predict earnings for a worker who is 67 inches tall, for a worker who is 70 inches tall, and for a worker who is 65 inches tall.

**Solution**

```{r}
# regression 
E42d <- lm(formula = earnings ~ height, data = Earnings_and_Height)

# i. estimated intercept, estimated slope
summary(E42d)

# predict value
E42d_predict <- function(x){
  E42d$coefficients %*% matrix(c(1, x), ncol = 1)
  
}

# ii. predict value: height = 67
E42d_predict(67)

# ii. predict value: height = 70
E42d_predict(70)

# ii. predict value: height = 65
E42d_predict(65)

```


> e. Suppose height were measured in centimeters instead of inches. Answer
the following questions about the $Earnings$ on $Height$ (in cm) regression.
>     i. What is the estimated slope of the regression?
>     ii. What is the estimated intercept?
>     iii. What is the $R^2$?
>     iv. What is the standard error of the regression?

**Solution**

```{r}
# translates from inches to cm
height_cm <- cm(Earnings_and_Height$height)

Earnings_and_Height <- cbind(Earnings_and_Height, height_cm)

# regression 
E42e <- lm(formula = earnings ~ height_cm, data = Earnings_and_Height)

# i. estimated slope # ii. estimated intercept
# iii. R^2 # iv. SE
summary(E42e)

```


> f. Run a regression of $Earnings$ on $Height$, using data for female workers
only.
>     i. What is the estimated slope?
>     ii. A randomly selected woman is 1 inch taller than the average woman in the sample. Would you predict her earnings to be higher or lower than the average earnings for women in the sample? By how much?

**Solution**

```{r}
# female
Earnings_and_Height_f <- Earnings_and_Height[Earnings_and_Height$sex == 0, ]

# regression 
E42f <- lm(formula = earnings ~ height, data = Earnings_and_Height_f)

# i. estimated slope # ii.
summary(E42f)

```
A women who is one inch taller than average is predicted to have earnings that are \$511.2 per year higher than average.

> g. Repeat (f) for male workers.

**Solution**

```{r}
# male
Earnings_and_Height_g <- Earnings_and_Height[Earnings_and_Height$sex == 1, ]

# regression 
E42g <- lm(formula = earnings ~ height, data = Earnings_and_Height_g)

# i. estimated slope # ii.
summary(E42g)
```
A man who is one inch taller than average is predicted to have earnings that are \$1306.9 per year higher than average.

> h. Do you think that height is uncorrelated with other factors that cause
earning? That is, do you think that the regression error term, ui has a conditional mean of 0 given $Height$ $(X_i)$? (You will investigate this more in the Earnings and Height exercises in later chapters.)

**Solution**

Height may be correlated with other factors that cause earnings. For example, height may be correlated with “strength,” and in some occupations, stronger workers may by more productive. There are many other potential factors that may be correlated with height and cause earnings and we will investigate of these in future exercises.






